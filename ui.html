<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Self-Check Design Assistant</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: var(--figma-color-text);
            background: var(--figma-color-bg);
            padding: 16px;
        }
        
        .header {
            background: var(--figma-color-bg-brand);
            color: var(--figma-color-text-onbrand);
            padding: 12px 16px;
            margin: -16px -16px 16px -16px;
            border-radius: 8px 8px 0 0;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }
        
        .section {
            margin-bottom: 20px;
        }
        
        .section-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--figma-color-text);
            font-size: 13px;
        }
        
        .selection-info {
            background: var(--figma-color-bg-secondary);
            border: 1px solid var(--figma-color-border);
            border-radius: 6px;
            padding: 12px;
            min-height: 80px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 10px;
            line-height: 1.4;
            color: var(--figma-color-text-secondary);
        }
        
        .selection-info.empty {
            color: var(--figma-color-text-disabled);
            font-style: italic;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .button {
            flex: 1;
            background: var(--figma-color-bg-brand);
            color: var(--figma-color-text-onbrand);
            border: none;
            border-radius: 6px;
            padding: 10px 16px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .button:hover:not(:disabled) {
            background: var(--figma-color-bg-brand-hover);
        }
        
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .button.secondary {
            background: var(--figma-color-bg-secondary);
            color: var(--figma-color-text);
            border: 1px solid var(--figma-color-border);
        }
        
        .button.secondary:hover:not(:disabled) {
            background: var(--figma-color-bg-hover);
        }
        
        .result-container {
            background: var(--figma-color-bg-secondary);
            border: 1px solid var(--figma-color-border);
            border-radius: 6px;
            min-height: 150px;
            position: relative;
            overflow: hidden;
        }
        
        .result-content {
            padding: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .loading {
            display: none;
            align-items: center;
            justify-content: center;
            height: 150px;
            color: var(--figma-color-text-secondary);
        }
        
        .loading.show {
            display: flex;
        }
        
        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid var(--figma-color-border);
            border-top: 2px solid var(--figma-color-bg-brand);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .result {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 11px;
            line-height: 1.5;
            white-space: pre-wrap;
            color: var(--figma-color-text-secondary);
        }
        
        .analysis-result {
            font-size: 12px;
            line-height: 1.5;
        }
        
        .score-badge {
            display: inline-block;
            background: var(--figma-color-bg-brand);
            color: var(--figma-color-text-onbrand);
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 12px;
        }
        
        .score-good { background: #0d9488; }
        .score-medium { background: #d97706; }
        .score-poor { background: #dc2626; }
        
        .violations {
            margin-bottom: 16px;
        }
        
        .violation-item {
            background: var(--figma-color-bg);
            border: 1px solid var(--figma-color-border);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--figma-color-text-danger);
        }
        
        .violation-item.high {
            border-left-color: #dc2626;
        }
        
        .violation-item.medium {
            border-left-color: #d97706;
        }
        
        .violation-item.low {
            border-left-color: #65a30d;
        }
        
        .violation-header {
            font-weight: 600;
            font-size: 11px;
            color: var(--figma-color-text);
            margin-bottom: 4px;
        }
        
        .violation-text {
            font-size: 10px;
            color: var(--figma-color-text-secondary);
            margin-bottom: 4px;
        }
        
        .violation-fix {
            font-size: 10px;
            color: var(--figma-color-text-secondary);
            background: var(--figma-color-bg-secondary);
            padding: 4px 6px;
            border-radius: 3px;
            font-style: italic;
        }
        
        .recommendations {
            margin-bottom: 16px;
        }
        
        .recommendation-item {
            background: var(--figma-color-bg);
            border: 1px solid var(--figma-color-border);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 8px;
            border-left: 3px solid var(--figma-color-bg-brand);
        }
        
        .recommendation-header {
            font-weight: 600;
            font-size: 11px;
            color: var(--figma-color-text);
            margin-bottom: 4px;
        }
        
        .recommendation-text {
            font-size: 10px;
            color: var(--figma-color-text-secondary);
            margin-bottom: 4px;
        }
        
        .recommendation-benefit {
            font-size: 10px;
            color: var(--figma-color-text-secondary);
            background: var(--figma-color-bg-secondary);
            padding: 4px 6px;
            border-radius: 3px;
            font-style: italic;
        }
        
        .positive-aspects {
            margin-bottom: 16px;
        }
        
        .positive-item {
            background: var(--figma-color-bg);
            border: 1px solid var(--figma-color-border);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 6px;
            border-left: 3px solid #0d9488;
        }
        
        .positive-item-text {
            font-size: 10px;
            color: var(--figma-color-text-secondary);
        }
        
        .section-subtitle {
            font-weight: 600;
            font-size: 12px;
            color: var(--figma-color-text);
            margin-bottom: 8px;
        }
        
        .design-system-gaps {
            margin-bottom: 16px;
        }
        
        .gap-item {
            background: var(--figma-color-bg);
            border: 1px solid var(--figma-color-border);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 6px;
            border-left: 3px solid #f59e0b;
        }
        
        .gap-text {
            font-size: 10px;
            color: var(--figma-color-text-secondary);
        }
        
        .violation-item.critical {
            border-left-color: #dc2626;
            background: rgba(220, 38, 38, 0.05);
        }
        
        .error {
            color: var(--figma-color-text-danger);
            font-weight: 500;
        }
        
        .empty-state {
            text-align: center;
            color: var(--figma-color-text-disabled);
            font-style: italic;
            padding: 40px 20px;
        }
        
        .close-button {
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: var(--figma-color-bg-secondary);
            color: var(--figma-color-text);
            border: 1px solid var(--figma-color-border);
            border-radius: 4px;
            padding: 6px 12px;
            font-size: 11px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .close-button:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="header">
        üé® Self-Check Design Assistant
    </div>
    
    <div class="section">
        <div class="section-title">ÏÑ†ÌÉùÎêú ÏöîÏÜå</div>
        <div id="selection-info" class="selection-info empty">
            ÏöîÏÜåÎ•º ÏÑ†ÌÉùÌïòÍ≥† ÌîåÎü¨Í∑∏Ïù∏ÏùÑ Ïã§ÌñâÌï¥Ï£ºÏÑ∏Ïöî.
        </div>
    </div>
    
    <div class="button-group">
        <button id="refresh-btn" class="button secondary">ÏÉàÎ°úÍ≥†Ïπ®</button>
        <button id="analyze-btn" class="button">Î∂ÑÏÑù Ïã§Ìñâ</button>
    </div>
    
    <div class="section">
        <div class="section-title">Î∂ÑÏÑù Í≤∞Í≥º</div>
        <div class="result-container">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                AI Î∂ÑÏÑù Ï§ë...
            </div>
            <div id="result-content" class="result-content">
                <div class="empty-state">
                    Î∂ÑÏÑù Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ ÎîîÏûêÏù∏ ÏõêÏπô Í≤ÄÌÜ†Î•º ÏãúÏûëÌïòÏÑ∏Ïöî.
                </div>
            </div>
        </div>
    </div>
    
    <button id="close-btn" class="close-button">Îã´Í∏∞</button>

<script>
        // UI ÏÉÅÌÉú Í¥ÄÎ¶¨
        const elements = {
            selectionInfo: document.getElementById('selection-info'),
            refreshBtn: document.getElementById('refresh-btn'),
            analyzeBtn: document.getElementById('analyze-btn'),
            loading: document.getElementById('loading'),
            resultContent: document.getElementById('result-content'),
            closeBtn: document.getElementById('close-btn')
        };
        
        let isAnalyzing = false;
        
        // Î°úÎî© ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        function setLoading(loading) {
            isAnalyzing = loading;
            elements.loading.classList.toggle('show', loading);
            elements.analyzeBtn.disabled = loading;
            elements.refreshBtn.disabled = loading;
            
            if (loading) {
                elements.resultContent.innerHTML = '';
            }
        }
        
        // ÏÑ†ÌÉù Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateSelectionInfo(info) {
            elements.selectionInfo.textContent = info;
            elements.selectionInfo.classList.toggle('empty', info === 'ÏÑ†ÌÉùÎêú ÏöîÏÜåÍ∞Ä ÏóÜÏäµÎãàÎã§.');
        }
        
        // Ï†êÏàòÏóê Îî∞Î•∏ ÌÅ¥ÎûòÏä§ Î∞òÌôò
        function getScoreClass(score) {
            const numScore = parseInt(score);
            // 100Ï†ê ÎßåÏ†êÏù∏ Í≤ΩÏö∞
            if (numScore > 10) {
                if (numScore >= 80) return 'score-good';
                if (numScore >= 60) return 'score-medium';
                return 'score-poor';
            }
            // 10Ï†ê ÎßåÏ†êÏù∏ Í≤ΩÏö∞
            if (numScore >= 8) return 'score-good';
            if (numScore >= 6) return 'score-medium';
            return 'score-poor';
        }
        
        // Î∂ÑÏÑù Í≤∞Í≥ºÎ•º HTMLÎ°ú Ìè¨Îß∑ÌåÖ
        function formatAnalysisResult(result) {
            let html = '<div class="analysis-result">';
            
            // Flowise Ïã§Ï†ú ÏùëÎãµ ÌòïÌÉú Ï≤òÎ¶¨
            if (result.score && typeof result.score === 'object') {
                // Ï†ÑÏ≤¥ Ï†êÏàò ÌëúÏãú
                if (result.score.overall) {
                    const scoreClass = getScoreClass(result.score.overall);
                    html += `<div class="score-badge ${scoreClass}">Ï†ÑÏ≤¥ Ï†êÏàò: ${result.score.overall}/100</div>`;
                }
                
                // ÏÑ∏Î∂Ä ÏõêÏπôÎ≥Ñ Ï†êÏàò
                if (result.score.principles) {
                    html += '<div class="section-subtitle">üìä ÏõêÏπôÎ≥Ñ Ï†êÏàò</div>';
                    html += '<div style="margin-bottom: 16px;">';
                    Object.entries(result.score.principles).forEach(([principle, score]) => {
                        const scoreClass = getScoreClass(Number(score) * 10); // 10Ï†ê ÎßåÏ†êÏúºÎ°ú Î≥ÄÌôò
                        html += `<div style="display: inline-block; margin: 4px 8px 4px 0;">`;
                        html += `<span style="background: var(--figma-color-bg-secondary); padding: 2px 6px; border-radius: 4px; font-size: 10px;">${principle}: ${score}/10</span>`;
                        html += '</div>';
                    });
                    html += '</div>';
                }
            }
            
            // ÏöîÏïΩ Ï†ïÎ≥¥
            if (result.summary) {
                html += '<div class="section-subtitle">üìã Î∂ÑÏÑù ÏöîÏïΩ</div>';
                html += `<div style="padding: 8px; background: var(--figma-color-bg-secondary); border-radius: 4px; margin-bottom: 12px; font-size: 11px;">${result.summary}</div>`;
            }
            
            // ÏúÑÎ∞òÏÇ¨Ìï≠ (Î∞∞Ïó¥ ÌòïÌÉú)
            if (result.violations && result.violations.length > 0) {
                html += '<div class="violations">';
                html += '<div class="section-subtitle">‚ö†Ô∏è ÏúÑÎ∞òÏÇ¨Ìï≠</div>';
                result.violations.forEach(violation => {
                    // violationÏùÄ [element, principle, issue, severity, fix] ÌòïÌÉú
                    const [element, principle, issue, severity, fix] = violation;
                    const severityClass = severity === 'high' ? 'high' : (severity === 'moderate' ? 'medium' : 'low');
                    
                    html += `<div class="violation-item ${severityClass}">`;
                    html += `<div class="violation-header">${principle} - ${element}</div>`;
                    html += `<div class="violation-text"><strong>Î¨∏Ï†ú:</strong> ${issue}</div>`;
                    if (fix) {
                        html += `<div class="violation-fix">üí° <strong>Ìï¥Í≤∞Î∞©Î≤ï:</strong> ${fix}</div>`;
                    }
                    html += '</div>';
                });
                html += '</div>';
            }
            
            // Ï§ÄÏàòÏÇ¨Ìï≠ (Î∞∞Ïó¥ ÌòïÌÉú)
            if (result.compliances && result.compliances.length > 0) {
                html += '<div class="positive-aspects">';
                html += '<div class="section-subtitle">‚úÖ Ï§ÄÏàòÏÇ¨Ìï≠</div>';
                result.compliances.forEach(compliance => {
                    // complianceÎäî [element, principle, reason, level] ÌòïÌÉú
                    const [element, principle, reason, level] = compliance;
                    
                    html += '<div class="positive-item">';
                    html += `<div class="positive-item-text"><strong>${principle}:</strong> ${reason} (${element})</div>`;
                    html += '</div>';
                });
                html += '</div>';
            }
            
            // Ï∂îÏ≤úÏÇ¨Ìï≠ (Î∞∞Ïó¥ ÌòïÌÉú)
            if (result.recommendations && result.recommendations.length > 0) {
                html += '<div class="recommendations">';
                html += '<div class="section-subtitle">üí° Ï∂îÏ≤úÏÇ¨Ìï≠</div>';
                result.recommendations.forEach(recommendation => {
                    // recommendationÏùÄ [priority, suggestion, impact] ÌòïÌÉú
                    const [priority, suggestion, impact] = recommendation;
                    const priorityBadge = priority === 'high' ? 'üî¥' : (priority === 'medium' ? 'üü°' : 'üü¢');
                    
                    html += '<div class="recommendation-item">';
                    html += `<div class="recommendation-header">${priorityBadge} ${priority.toUpperCase()}</div>`;
                    html += `<div class="recommendation-text">${suggestion}</div>`;
                    if (impact) {
                        html += `<div class="recommendation-benefit">‚ú® <strong>Ìö®Í≥º:</strong> ${impact}</div>`;
                    }
                    html += '</div>';
                });
                html += '</div>';
            }
            
            // Í∞ÑÎã®Ìïú ÌòïÌÉúÏùò ÏùëÎãµ Ï≤òÎ¶¨ (Ïù¥Ï†Ñ Î≤ÑÏ†ÑÍ≥ºÏùò Ìò∏ÌôòÏÑ±)
            if (result.score && typeof result.score === 'string' && (result.issues || result.suggestions)) {
                // Ï†êÏàò ÌëúÏãú
                const scoreClass = getScoreClass(result.score);
                html += `<div class="score-badge ${scoreClass}">Ï†êÏàò: ${result.score}/10</div>`;
                
                // Î¨∏Ï†úÏ†ê ÌëúÏãú
                if (result.issues && result.issues.length > 0) {
                    html += '<div class="violations">';
                    html += '<div class="section-subtitle">‚ö†Ô∏è Î∞úÍ≤¨Îêú Î¨∏Ï†úÏ†ê</div>';
                    result.issues.forEach(issue => {
                        html += `<div class="violation-item medium">`;
                        html += `<div class="violation-text">${issue}</div>`;
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                // Í∞úÏÑ† Ï†úÏïà ÌëúÏãú
                if (result.suggestions && result.suggestions.length > 0) {
                    html += '<div class="recommendations">';
                    html += '<div class="section-subtitle">üí° Í∞úÏÑ† Ï†úÏïà</div>';
                    result.suggestions.forEach(suggestion => {
                        html += '<div class="recommendation-item">';
                        html += `<div class="recommendation-text">${suggestion}</div>`;
                        html += '</div>';
                    });
                    html += '</div>';
                }
                
                html += '</div>';
                return html;
            }
            
            // ÏÇ¨ÎÇ¥ ÏõêÏπô Ï§ÄÏàò Ï†êÏàò (Ïù¥Ï†Ñ Î≤ÑÏ†ÑÍ≥ºÏùò Ìò∏ÌôòÏÑ±)
            if (result.overall_compliance_score) {
                const scoreClass = getScoreClass(result.overall_compliance_score);
                html += `<div class="score-badge ${scoreClass}">ÏÇ¨ÎÇ¥ ÏõêÏπô Ï§ÄÏàò Ï†êÏàò: ${result.overall_compliance_score}/10</div>`;
            }
            
            // Í∏∞Ï°¥ ÏÉÅÏÑ∏ Íµ¨Ï°∞ Ï≤òÎ¶¨ (Ïù¥Ï†Ñ Î≤ÑÏ†ÑÍ≥ºÏùò Ìò∏ÌôòÏÑ±)
            if (result.violations && result.violations.length > 0 && typeof result.violations[0] === 'object') {
                html += '<div class="violations">';
                html += '<div class="section-subtitle">‚ö†Ô∏è ÏÇ¨ÎÇ¥ Í∑úÏπô ÏúÑÎ∞òÏÇ¨Ìï≠</div>';
                result.violations.forEach(violation => {
                    const severityClass = violation.severity === 'critical' ? 'high' : (violation.severity || 'medium');
                    html += `<div class="violation-item ${severityClass}">`;
                    html += `<div class="violation-header">${violation.category || 'ÏùºÎ∞ò'} - ${violation.element || 'Ìï¥Îãπ ÏöîÏÜå'}</div>`;
                    
                    if (violation.rule_violated) {
                        html += `<div class="violation-text"><strong>ÏúÑÎ∞ò Í∑úÏπô:</strong> ${violation.rule_violated}</div>`;
                    }
                    
                    if (violation.current_state) {
                        html += `<div class="violation-text"><strong>ÌòÑÏû¨ ÏÉÅÌÉú:</strong> ${violation.current_state}</div>`;
                    }
                    
                    if (violation.required_state) {
                        html += `<div class="violation-text"><strong>ÏöîÍµ¨ ÏÉÅÌÉú:</strong> ${violation.required_state}</div>`;
                    }
                    
                    if (violation.fix_action) {
                        html += `<div class="violation-fix">üí° <strong>ÏàòÏ†ï Î∞©Î≤ï:</strong> ${violation.fix_action}</div>`;
                    }
                    
                    html += '</div>';
                });
                html += '</div>';
            }
            
            // Î©îÏãúÏßÄÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ (ÌååÏã± Ïã§Ìå® Îì±)
            if (result.message) {
                html += `<div class="section-subtitle">üìÑ Î©îÏãúÏßÄ</div>`;
                html += `<div style="padding: 8px; background: var(--figma-color-bg-secondary); border-radius: 4px; margin-bottom: 12px;">${result.message}</div>`;
            }
            
            // ÏõêÎ≥∏ Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ (ÌååÏã± Ïã§Ìå®Ïãú)
            if (result.raw_analysis) {
                html += `<div class="section-subtitle">üìÑ ÏõêÎ≥∏ Î∂ÑÏÑù Í≤∞Í≥º</div>`;
                html += `<pre style="background: var(--figma-color-bg-secondary); padding: 8px; border-radius: 4px; font-size: 10px; max-height: 200px; overflow-y: auto; white-space: pre-wrap;">${result.raw_analysis}</pre>`;
            }
            
            html += '</div>';
            return html;
        }
        
        // Í≤∞Í≥º ÌëúÏãú
        function displayResult(result) {
            try {
                let htmlContent;
                
                // ÎîîÎ≤ÑÍπÖ Ï†ïÎ≥¥Í∞Ä ÏûàÎäî Í≤ΩÏö∞ (ÌååÏã± Ïã§Ìå® Îì±)
                if (result.raw_response && result.parse_error) {
                    htmlContent = `
                        <div class="result error">
                            <h3>‚ö†Ô∏è JSON ÌååÏã± Ïò§Î•ò</h3>
                            <p><strong>ÌååÏã± ÏóêÎü¨:</strong> ${result.parse_error}</p>
                            <br>
                            <p><strong>ÏõêÎ≥∏ ÏùëÎãµ:</strong></p>
                            <pre style="background: var(--figma-color-bg-secondary); padding: 8px; border-radius: 4px; font-size: 10px; max-height: 200px; overflow-y: auto;">${result.raw_response}</pre>
                        </div>
                    `;
                } else if (typeof result === 'string') {
                    // Î¨∏ÏûêÏó¥Ïù∏ Í≤ΩÏö∞ JSON ÌååÏã± ÏãúÎèÑ
                    try {
                        const parsed = JSON.parse(result);
                        htmlContent = formatAnalysisResult(parsed);
                    } catch (e) {
                        htmlContent = `
                            <div class="result">
                                <h3>üìã ÏùëÎãµ ÎÇ¥Ïö©</h3>
                                <pre style="background: var(--figma-color-bg-secondary); padding: 8px; border-radius: 4px; font-size: 10px; max-height: 200px; overflow-y: auto;">${result}</pre>
                            </div>
                        `;
                    }
                } else if (typeof result === 'object' && result !== null) {
                    // Í∞ùÏ≤¥Ïù∏ Í≤ΩÏö∞ Íµ¨Ï°∞ÌôîÎêú ÌëúÏãú
                    htmlContent = formatAnalysisResult(result);
                } else {
                    htmlContent = `
                        <div class="result">
                            <h3>üìã ÏùëÎãµ ÎÇ¥Ïö©</h3>
                            <pre style="background: var(--figma-color-bg-secondary); padding: 8px; border-radius: 4px; font-size: 10px;">${String(result)}</pre>
                        </div>
                    `;
                }
                
                elements.resultContent.innerHTML = htmlContent;
            } catch (error) {
                elements.resultContent.innerHTML = `<div class="result error">Í≤∞Í≥º ÌëúÏãú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${error.message}</div>`;
            }
        }
        
        // ÏóêÎü¨ ÌëúÏãú
        function displayError(errorMessage) {
            elements.resultContent.innerHTML = `<div class="result error">‚ùå ${errorMessage}</div>`;
        }
        
        // Î©îÏãúÏßÄ ÏàòÏã† Ï≤òÎ¶¨
        window.onmessage = (event) => {
            const { type, payload } = event.data.pluginMessage || {};
            
            switch (type) {
                case 'SELECTION_INFO':
                    updateSelectionInfo(payload);
                    break;
                    
                case 'ANALYSIS_LOADING':
                    setLoading(payload);
                    break;
                    
                case 'ANALYSIS_RESULT':
                    displayResult(payload);
                    break;
                    
                case 'ANALYSIS_ERROR':
                    displayError(payload);
                    break;
            }
        };
        
        // Î≤ÑÌäº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        elements.refreshBtn.onclick = () => {
            parent.postMessage({ 
                pluginMessage: { type: 'REQUEST_SELECTION' } 
            }, '*');
        };
        
        elements.analyzeBtn.onclick = () => {
            if (isAnalyzing) return;
            
            parent.postMessage({ 
                pluginMessage: { type: 'RUN_ANALYSIS' } 
            }, '*');
        };
        
        elements.closeBtn.onclick = () => {
            parent.postMessage({ 
                pluginMessage: { type: 'CLOSE_PLUGIN' } 
            }, '*');
        };
        
        // Ï¥àÍ∏∞ ÏÑ†ÌÉù Ï†ïÎ≥¥ ÏöîÏ≤≠
        parent.postMessage({ 
            pluginMessage: { type: 'REQUEST_SELECTION' } 
        }, '*');
</script>
</body>
</html>
